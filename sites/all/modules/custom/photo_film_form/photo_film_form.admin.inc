<?php


/**
 * Settings form for photo_film_form module
 */
function photo_film_form_settings_form($form_state) {
  $vocabularies = taxonomy_get_vocabularies();
  $options = array();

  foreach ($vocabularies as $vocabulary) {
    $options[$vocabulary->vid] = $vocabulary->name;
  }

  $form = array();

  $form['first_step'] = array(
    '#type' => 'fieldset',
    '#title' => t('Select taxonomy per step'),
  );

  $form['first_step']['photo_film_form_theme_vid'] = array(
    '#title' => t('Themes vocabulary'),
    '#type' => 'select',
    '#options' => $options,
    '#default_value' => variable_get('photo_film_form_theme_vid', FALSE),
    '#required' => TRUE,
  );

  $form['first_step']['photo_film_form_theme_form_title'] = array(
    '#title' => t('Enter the title of the first step, which will be displayed to user'),
    '#type' => 'textarea',
    '#default_value' => variable_get('photo_film_form_theme_form_title', ''),
    '#required' => FALSE,
  );

  $form['second_step'] = array(
    '#type' => 'fieldset',
    '#title' => t('Select taxonomy for second step'),
  );

  $form['second_step']['photo_film_form_style_vid'] = array(
    '#title' => t('Styles vocabulary'),
    '#type' => 'select',
    '#options' => $options,
    '#default_value' => variable_get('photo_film_form_style_vid', FALSE),
    '#required' => TRUE,
  );

  $form['second_step']['photo_film_form_style_form_title'] = array(
    '#title' => t('Enter the title of the first step, which will be displayed to user'),
    '#type' => 'textarea',
    '#default_value' => variable_get('photo_film_form_style_form_title', ''),
    '#required' => FALSE,
  );

  return system_settings_form($form);
}

/**
 * page callback for admin/photo-film/save-file/%file_stream
 */
function photo_film_save_file($file_stream) {
  $file_id = FALSE;
  // try to save a file, if not return false
  if ($file_loaded = file_save_upload($file_stream, array(), "public://", $replace = FILE_EXISTS_RENAME)) {
    $file_id = $file_loaded->fid;
  }

  return drupal_json_output($file_id);
}